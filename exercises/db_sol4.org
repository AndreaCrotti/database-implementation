EXERCISE 4
#+SETUPFILE: group.org

* TODO EXERCISE 4
  DEADLINE: <2009-11-18 Mer>
  
* 1. Concurrency Control in B+-Trees
** 1. Search the data entry 35*
   For searching we only need to go deeper in the tree, read lock child and unlock parent iteratively.
   So we:
   - rl A
   - rl B
   - rul A
   - rl C
   - rul B
   - rl D
   - rul C
   - r D
   - rul D
     
   And we're done now we can read the value from the key 38 and unlock it

We're looking for 35*, therefore we should rl the I-Key and read the value from 35* ?!

** 2. Search for all data entries k* with k* < 35
   For convenience of typing when we write:
   /<op> <obj1> <obj2>/ ... means the we can apply the operator in parallel, then equivalent to /op(obj1), op(obj2).../

   Here we need to read all the data from the left sibling and left child of node B.
   - rl A
   - rl B, J
#[seb] I didn`t attend the lecture and the slides are not specific. But I guess its possible [/seb]
   - rl F, K, L
   - rul B, J
   - rl M, N, O, P, G, H
   - rul K, L, F
   
   At this point we can read all the leaf nodes where the index k* < 35 (and unlock them after read of course).

** 3. Insert data entry 60*
   Here we see that E is not full, so we can just insert our node there.
   But we don't know if the node is actually safe until we reach the end and see it's half empty.

   Therefore it should be:
   - wl A
   - wl B => B is safe,
   - wul A
   - wl C
   - wl E  => E is safe, so:
   - wul C, B
   - write 60* in E
   - wul E

** 4. Delete data entry 20*
   - wl A
   - wl B 
   - wl F 
   - wl G => G is safe, as it contains more than k*/2 values (k* is obviously =1)
   - wul A,B,F
   - delete 20* from G
   - wul G

** 5. Insert data entries 60* and 75*
*** Insert 60* 
       - see 1.3
*** now insert 75*
    - wl A
    - wl B, B is safe =>
    - wul A
    - wl C
    - wl E
    - insert 75* in E => overflow
    - split E into E1 {44*,60*} and E2 {75*}. propagate insert to C
    - insert 75* in C => overflow
    - split C into C1 {38,44} and C2 {75}. propagate insert to B
    - insert 75 into B
    - wul B, C1, C2, E1, E2

* 2. Multiple-Granularity Locking
** 1. Read record P1200 : 5.
   
** 2. Read records P1200 : 98 through P1205 : 2.
   
** 3. Read all (records on all) pages in file F1.
   
** 4. Read pages P500 through P520.
   
** 5. Read pages P10 through P980.
   
** 6. Read all pages in F1 and (based on the values read) modify 10 pages.
   
** 7. Delete record P1200 : 98. (This is a blind write.)
   
** 8. Delete the first record from each page. (Again, these are blind writes.)
   
** 9. Delete all records.
